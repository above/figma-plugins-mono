
<!-- load socket.io -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>

<!-- Create socket, set port -->
<script>
  var socket = io("ws://localhost:3000", { transports: ["websocket"] });
</script>

<!-- UI Styling -->
<style>
* {
  font-size: 100%;
  font-family: monospace;
 }
</style>

<!-- UI content -->
<body>
<h2>Rotary Toggle Example</h2>
<div id="msg_monitor_div">
  <p class="msg_p" id="msg_0"></p>
  <p class="msg_p" id="msg_1"></p>
  <p class="msg_p" id="msg_2"></p>
  <p class="msg_p" id="msg_3"></p>
  <p class="msg_p" id="msg_4"></p>
</div>
</body>

<!-- Read sockets, update UI, post data to plugin -->
<script>

  // Display the incoming messages in the UI window
  let msg_buffer = [];

  // Receiving last input from plugin and display in the UI
  onmessage = (event) => {
    const msg = event.data.pluginMessage;
    msg_buffer.unshift(msg);
    msg_buffer.length = 5;

    for(let i = 0; i < msg_buffer.length; i++) {
      const msg_id = "msg_" + i;
      const msg_p = document.getElementById(msg_id);
      // Add timestamp
      const date = new Date();
      const time = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();

      if(msg_buffer[i] !== undefined) {
        msg_p.innerText = time + " | " + msg_buffer[i];
      }
    } 
}


// Read messagees from sockets and send to Figma, we are reading
//   "SELECT" for a the switch
//   "ROTARY_CW" for clockwise rotation
//   "ROTARY_CCW" for counterclockwise rotation

  socket.on("SELECT", (msg) => {
    parent.postMessage({ pluginMessage: { type: "SELECT", msg } }, "*");
  });

  socket.on("ROTARY_CW", (msg) => {
    parent.postMessage({ pluginMessage: { type: "ROTARY_CW", msg } }, "*");
  });

  socket.on("ROTARY_CCW", (msg) => {
    parent.postMessage({ pluginMessage: { type: "ROTARY_CCW", msg } }, "*");
  });

</script>
